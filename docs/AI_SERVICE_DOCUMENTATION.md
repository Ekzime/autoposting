# ü§ñ AI Service Documentation

## –û–≥–ª–∞–≤–ª–µ–Ω–∏–µ
1. [–û–±—â–µ–µ –æ–ø–∏—Å–∞–Ω–∏–µ](#–æ–±—â–µ–µ-–æ–ø–∏—Å–∞–Ω–∏–µ)
2. [–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–∏—Å—Ç–µ–º—ã](#–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞-—Å–∏—Å—Ç–µ–º—ã)
3. [API –≠–Ω–¥–ø–æ–∏–Ω—Ç—ã](#api-—ç–Ω–¥–ø–æ–∏–Ω—Ç—ã)
4. [–°–∏—Å—Ç–µ–º–∞ –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è](#—Å–∏—Å—Ç–µ–º–∞-–∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è)
5. [–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞ –∫–µ—à–∞](#–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è-–æ—á–∏—Å—Ç–∫–∞-–∫–µ—à–∞)
6. [–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è](#–Ω–∞—Å—Ç—Ä–æ–π–∫–∞-–∏-–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è)
7. [–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ –±–æ—Ç–∞](#–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ-—á–µ—Ä–µ–∑-–±–æ—Ç–∞)
8. [–ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è](#–ø—Ä–∏–º–µ—Ä—ã-–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è)
9. [–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –æ—Ç–ª–∞–¥–∫–∞](#–º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥-–∏-–æ—Ç–ª–∞–¥–∫–∞)
10. [Troubleshooting](#troubleshooting)

---

## –û–±—â–µ–µ –æ–ø–∏—Å–∞–Ω–∏–µ

AI Service - —ç—Ç–æ –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å –Ω–∞ –±–∞–∑–µ **Google Gemini API** –∏ **FastAPI**, –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω–Ω—ã–π –¥–ª—è:

- üîç **–§–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –ø–æ—Å—Ç–æ–≤** - —É–¥–∞–ª–µ–Ω–∏–µ —Ä–µ–∫–ª–∞–º—ã, —Å–ø–∞–º–∞ –∏ –Ω–∏–∑–∫–æ–∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
- üö´ **–ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –¥—É–±–ª–∏–∫–∞—Ç–æ–≤** - —Å–∏—Å—Ç–µ–º–∞ –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è –¥–ª—è –∏–∑–±–µ–∂–∞–Ω–∏—è –ø–æ–≤—Ç–æ—Ä—è—é—â–µ–≥–æ—Å—è –∫–æ–Ω—Ç–µ–Ω—Ç–∞
- ‚ú® **–£–ª—É—á—à–µ–Ω–∏—è –∫–∞—á–µ—Å—Ç–≤–∞** - –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∏ –æ—á–∏—Å—Ç–∫–∞ —Ç–µ–∫—Å—Ç–∞ –ø–æ—Å—Ç–æ–≤
- üîÑ **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è** - –∞–≤—Ç–æ–æ—á–∏—Å—Ç–∫–∞ –∫–µ—à–∞ –∫–∞–∂–¥—ã–µ 24 —á–∞—Å–∞

### –ö–ª—é—á–µ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ–¥–∏–Ω–æ—á–Ω—ã—Ö –ø–æ—Å—Ç–æ–≤ –∏ –±–∞—Ç—á–µ–π
- –ò–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω–∞—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –¥—É–±–ª–∏–∫–∞—Ç–æ–≤
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
- RESTful API —Å –ø–æ–¥—Ä–æ–±–Ω–æ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–æ–π
- –ê–≤—Ç–æ–Ω–æ–º–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–µ—à–µ–º

---

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–∏—Å—Ç–µ–º—ã

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   Telegram Bot  ‚îÇ‚îÄ‚îÄ‚îÄ‚ñ∂‚îÇ   AI Service    ‚îÇ‚îÄ‚îÄ‚îÄ‚ñ∂‚îÇ  Google Gemini  ‚îÇ
‚îÇ                 ‚îÇ    ‚îÇ   (FastAPI)     ‚îÇ    ‚îÇ      API        ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ                       ‚îÇ
         ‚îÇ              ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
         ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∂‚îÇ Cache System    ‚îÇ
                        ‚îÇ (In-Memory)     ‚îÇ
                        ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

#### 1. **FastAPI Application** (`AIservice/gemini.py`)
- –û—Å–Ω–æ–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Å REST API
- CORS middleware –¥–ª—è –∫—Ä–æ—Å—Å-–¥–æ–º–µ–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
- –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö —á–µ—Ä–µ–∑ Pydantic

#### 2. **Google Gemini Integration**
- –ú–æ–¥–µ–ª—å: `gemini-1.5-flash`
- –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ç–µ–∫—Å—Ç–∞ —á–µ—Ä–µ–∑ prompt engineering
- –ü–∞—Ä—Å–∏–Ω–≥ –æ—Ç–≤–µ—Ç–æ–≤ –≤ JSON —Ñ–æ—Ä–º–∞—Ç–µ

#### 3. **Cache System**
- In-memory –∫–µ—à –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã—Ö –ø–æ—Å—Ç–æ–≤
- MD5 —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞ –∫–∞–∂–¥—ã–µ 24 —á–∞—Å–∞

#### 4. **Prompt System** (`AIservice/prompts.py`)
- –°–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø—Ä–æ–º–ø—Ç—ã –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏
- –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—é –¥—É–±–ª–∏–∫–∞—Ç–æ–≤
- –ü—Ä–∞–≤–∏–ª–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Ç–∏–ø–æ–≤ –∫–æ–Ω—Ç–µ–Ω—Ç–∞

---

## API –≠–Ω–¥–ø–æ–∏–Ω—Ç—ã

### 1. **POST** `/gemini/filter`
–û—Å–Ω–æ–≤–Ω–æ–π —ç–Ω–¥–ø–æ–∏–Ω—Ç –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –ø–æ—Å—Ç–æ–≤.

**Request Body:**
```json
{
  "posts": ["–¢–µ–∫—Å—Ç –ø–æ—Å—Ç–∞ 1", "–¢–µ–∫—Å—Ç –ø–æ—Å—Ç–∞ 2"],
  "has_image": false
}
```

**Response:**
```json
{
  "status": "success",
  "result": [
    {"text": "–û–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç –ø–æ—Å—Ç–∞ 1"},
    {"text": "–û–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç –ø–æ—Å—Ç–∞ 2"}
  ]
}
```

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `posts` (array[string], required) - –ú–∞—Å—Å–∏–≤ —Ç–µ–∫—Å—Ç–æ–≤ –ø–æ—Å—Ç–æ–≤ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏
- `has_image` (boolean, optional) - –£–∫–∞–∑—ã–≤–∞–µ—Ç, –µ—Å—Ç—å –ª–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤ –ø–æ—Å—Ç–∞—Ö

### 2. **POST** `/gemini/clear_cache`
–†—É—á–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ –∫–µ—à–∞ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤.

**Response:**
```json
{
  "status": "success",
  "message": "–ö–µ—à –æ—á–∏—â–µ–Ω –≤—Ä—É—á–Ω—É—é. –£–¥–∞–ª–µ–Ω–æ 150 –∑–∞–ø–∏—Å–µ–π."
}
```

### 3. **GET** `/gemini/cache_stats`
–ü–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –∫–µ—à–∞.

**Response:**
```json
{
  "status": "success",
  "cache_size": 1250,
  "recent_hashes": ["abc123...", "def456..."],
  "last_auto_clear": "2024-01-15 14:30:00",
  "hours_since_clear": 12.5,
  "hours_until_next_clear": 11.5,
  "next_auto_clear": "2024-01-16 14:30:00"
}
```

### 4. **POST** `/gemini/force_auto_clear`
–ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω—ã–π –∑–∞–ø—É—Å–∫ –∞–≤—Ç–æ–æ—á–∏—Å—Ç–∫–∏ –∫–µ—à–∞.

**Response:**
```json
{
  "status": "success",
  "message": "–ê–≤—Ç–æ–æ—á–∏—Å—Ç–∫–∞ –∫–µ—à–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ"
}
```

---

## –°–∏—Å—Ç–µ–º–∞ –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è

### –ü—Ä–∏–Ω—Ü–∏–ø —Ä–∞–±–æ—Ç—ã

1. **–ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ö–µ—à–∞** - –∫–∞–∂–¥—ã–π –ø–æ—Å—Ç –Ω–æ—Ä–º–∞–ª–∏–∑—É–µ—Ç—Å—è –∏ —Ö–µ—à–∏—Ä—É–µ—Ç—Å—è:
   ```python
   # –£–±–∏—Ä–∞–µ–º –ø—É–Ω–∫—Ç—É–∞—Ü–∏—é, –ø—Ä–∏–≤–æ–¥–∏–º –∫ –Ω–∏–∂–Ω–µ–º—É —Ä–µ–≥–∏—Å—Ç—Ä—É
   normalized = re.sub(r'[^\w\s]', '', text.lower())
   hash = hashlib.md5(normalized.encode()).hexdigest()
   ```

2. **–ü—Ä–æ–≤–µ—Ä–∫–∞ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤** - –Ω–æ–≤—ã–µ –ø–æ—Å—Ç—ã —Å—Ä–∞–≤–Ω–∏–≤–∞—é—Ç—Å—è —Å –∫–µ—à–µ–º:
   - –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –¥—É–±–ª–∏–∫–∞—Ç—ã (–º–µ–∂–¥—É —Å–µ—Å—Å–∏—è–º–∏)
   - –°–µ—Å—Å–∏–æ–Ω–Ω—ã–µ –¥—É–±–ª–∏–∫–∞—Ç—ã (–≤ —Ä–∞–º–∫–∞—Ö –æ–¥–Ω–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞)

3. **–§–∏–ª—å—Ç—Ä–∞—Ü–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤** - AI —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–∞–∫–∂–µ –ø—Ä–æ–≤–µ—Ä—è—é—Ç—Å—è –Ω–∞ –¥—É–±–ª–∏–∫–∞—Ç—ã

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–µ—à–∞

```python
# –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
processed_content_hashes = set()  # –ú–Ω–æ–∂–µ—Å—Ç–≤–æ —Ö–µ—à–µ–π –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã—Ö –ø–æ—Å—Ç–æ–≤
last_cache_clear = datetime.now()  # –í—Ä–µ–º—è –ø–æ—Å–ª–µ–¥–Ω–µ–π –æ—á–∏—Å—Ç–∫–∏
```

### –ü—Ä–∏–º–µ—Ä—ã –¥—É–±–ª–∏–∫–∞—Ç–æ–≤

**–û–±–Ω–∞—Ä—É–∂–∏–≤–∞—é—Ç—Å—è –∫–∞–∫ –¥—É–±–ª–∏–∫–∞—Ç—ã:**
- "Bitcoin –¥–æ—Å—Ç–∏–≥ $100k" ‚Üí "bitcoin –¥–æ—Å—Ç–∏–≥ 100k"
- "üöÄ BTC –Ω–æ–≤—ã–π –º–∞–∫—Å–∏–º—É–º!!!" ‚Üí "btc –Ω–æ–≤—ã–π –º–∞–∫—Å–∏–º—É–º"
- "–ë–∏—Ç–∫–æ–∏–Ω - $100,000" ‚Üí "–±–∏—Ç–∫–æ–∏–Ω 100000"

---

## –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞ –∫–µ—à–∞

### –õ–æ–≥–∏–∫–∞ –∞–≤—Ç–æ–æ—á–∏—Å—Ç–∫–∏

```python
def check_and_auto_clear_cache():
    current_time = datetime.now()
    hours_passed = (current_time - last_cache_clear).total_seconds() / 3600
    
    if hours_passed >= 24:
        cache_size_before = len(processed_content_hashes)
        processed_content_hashes.clear()
        last_cache_clear = current_time
        return True
    return False
```

### –ö–æ–≥–¥–∞ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø—Ä–æ–≤–µ—Ä–∫–∞
- –ü—Ä–∏ –∫–∞–∂–¥–æ–º –≤—ã–∑–æ–≤–µ `process_posts()`
- –ü—Ä–∏ –∫–∞–∂–¥–æ–º –≤—ã–∑–æ–≤–µ `filter_duplicate_results()`
- –ü—Ä–∏ –∑–∞–ø—Ä–æ—Å–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –∫–µ—à–∞
- –ü—Ä–∏ –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–π –æ—á–∏—Å—Ç–∫–µ

### –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –∞–≤—Ç–æ–æ—á–∏—Å—Ç–∫–∏
- ‚úÖ –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∏–µ –ø–∞–º—è—Ç–∏
- ‚úÖ –°—Ç–∞—Ä—ã–µ –Ω–æ–≤–æ—Å—Ç–∏ –Ω–µ –±–ª–æ–∫–∏—Ä—É—é—Ç –Ω–æ–≤—ã–µ —Å–æ–±—ã—Ç–∏—è
- ‚úÖ –ê–≤—Ç–æ–Ω–æ–º–Ω–æ—Å—Ç—å —Ä–∞–±–æ—Ç—ã
- ‚úÖ –ê–∫—Ç—É–∞–ª—å–Ω–æ—Å—Ç—å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏

---

## –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### 1. –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
```bash
# Google Gemini API
GEMINI_API_KEY=your_gemini_api_key_here

# AI Service URL
AI_SERVICE_URL=http://localhost:8000/gemini/filter
```

### 2. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –≤ `config/settings.py`
```python
class AIServiceSettings(BaseModel):
    gemini_key: str
    api_url: str = "http://localhost:8000/gemini/filter"
```

### 3. –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–∏—Å–∞
```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
pip install fastapi uvicorn google-generativeai

# –ó–∞–ø—É—Å–∫ –≤ development —Ä–µ–∂–∏–º–µ
uvicorn AIservice.gemini:app --host 0.0.0.0 --port 8000 --reload

# –ó–∞–ø—É—Å–∫ –≤ production —Ä–µ–∂–∏–º–µ
uvicorn AIservice.gemini:app --host 0.0.0.0 --port 8000 --workers 4
```

### 4. Docker –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
```dockerfile
FROM python:3.10-slim

WORKDIR /app
COPY requirements.txt .
RUN pip install -r requirements.txt

COPY AIservice/ ./AIservice/
COPY config/ ./config/

EXPOSE 8000
CMD ["uvicorn", "AIservice.gemini:app", "--host", "0.0.0.0", "--port", "8000"]
```

---

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ –±–æ—Ç–∞

### –ö–æ–º–∞–Ω–¥—ã –±–æ—Ç–∞

#### `/ai_cache_stats` - –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∫–µ—à–∞
```
üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∫–µ—à–∞ AI —Å–µ—Ä–≤–∏—Å–∞

üóÉÔ∏è –†–∞–∑–º–µ—Ä –∫–µ—à–∞: 1250 –∑–∞–ø–∏—Å–µ–π
üìù –≠—Ç–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –ø–æ—Å—Ç–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ —É–∂–µ –±—ã–ª–∏ –æ–±—Ä–∞–±–æ—Ç–∞–Ω—ã

‚è∞ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞:
‚Ä¢ –ü–æ—Å–ª–µ–¥–Ω—è—è –æ—á–∏—Å—Ç–∫–∞: 2024-01-15 14:30:00
‚Ä¢ –ü—Ä–æ—à–ª–æ —á–∞—Å–æ–≤: 12.5
‚Ä¢ –î–æ —Å–ª–µ–¥—É—é—â–µ–π –æ—á–∏—Å—Ç–∫–∏: 11.5 —á.
‚Ä¢ –°–ª–µ–¥—É—é—â–∞—è –æ—á–∏—Å—Ç–∫–∞: 2024-01-16 14:30:00
```

#### `/clear_ai_cache` - –†—É—á–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞
```
‚úÖ –ö–µ—à –æ—á–∏—â–µ–Ω –≤—Ä—É—á–Ω—É—é. –£–¥–∞–ª–µ–Ω–æ 1250 –∑–∞–ø–∏—Å–µ–π.
```

#### `/force_auto_clear` - –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è –∞–≤—Ç–æ–æ—á–∏—Å—Ç–∫–∞
```
‚úÖ –ê–≤—Ç–æ–æ—á–∏—Å—Ç–∫–∞ –∫–µ—à–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ
```

### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ `posting_worker.py`

```python
async def process_with_ai(posts, has_image=False):
    ai_service_url = settings.ai_service.api_url
    
    async with httpx.AsyncClient(timeout=60.0) as client:
        payload = {
            "posts": posts,
            "has_image": has_image
        }
        
        response = await client.post(ai_service_url, json=payload)
        
        if response.status_code == 200:
            result = response.json()
            return result.get('result', [])
        else:
            logger.error(f"AI service error: {response.status_code}")
            return []
```

---

## –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### 1. –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ–¥–Ω–æ–≥–æ –ø–æ—Å—Ç–∞

**Request:**
```bash
curl -X POST http://localhost:8000/gemini/filter \
  -H "Content-Type: application/json" \
  -d '{
    "posts": ["üöÄ Bitcoin –¥–æ—Å—Ç–∏–≥ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–æ–≥–æ –º–∞–∫—Å–∏–º—É–º–∞ –≤ $100,000! üìà"],
    "has_image": false
  }'
```

**Response:**
```json
{
  "status": "success",
  "result": [
    {
      "text": "Bitcoin –¥–æ—Å—Ç–∏–≥ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–æ–≥–æ –º–∞–∫—Å–∏–º—É–º–∞ –≤ $100,000, —É—Å—Ç–∞–Ω–æ–≤–∏–≤ –Ω–æ–≤—ã–π —Ä–µ–∫–æ—Ä–¥ –Ω–∞ –∫—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç–Ω–æ–º —Ä—ã–Ω–∫–µ."
    }
  ]
}
```

### 2. Batch –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Å –¥—É–±–ª–∏–∫–∞—Ç–∞–º–∏

**Request:**
```json
{
  "posts": [
    "Bitcoin –¥–æ—Å—Ç–∏–≥ $100k",
    "–ë–∏—Ç–∫–æ–∏–Ω —É—Å—Ç–∞–Ω–æ–≤–∏–ª —Ä–µ–∫–æ—Ä–¥ –Ω–∞ –æ—Ç–º–µ—Ç–∫–µ $100,000",
    "Ethereum –∑–∞–ø—É—Å—Ç–∏–ª –Ω–æ–≤–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ",
    "üìà BTC = $100000 üöÄüöÄüöÄ"
  ],
  "has_image": false
}
```

**Response:**
```json
{
  "status": "success",
  "result": [
    {
      "text": "Bitcoin –¥–æ—Å—Ç–∏–≥ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–æ–≥–æ –º–∞–∫—Å–∏–º—É–º–∞ –≤ $100,000"
    },
    {
      "text": "Ethereum —É—Å–ø–µ—à–Ω–æ –∑–∞–ø—É—Å—Ç–∏–ª –Ω–æ–≤–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ—Ç–æ–∫–æ–ª–∞"
    }
  ]
}
```

### 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –∫–µ—à–∞

**Request:**
```bash
curl -X GET http://localhost:8000/gemini/cache_stats
```

### 4. –û—á–∏—Å—Ç–∫–∞ –∫–µ—à–∞

**Request:**
```bash
curl -X POST http://localhost:8000/gemini/clear_cache
```

---

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –æ—Ç–ª–∞–¥–∫–∞

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

AI —Å–µ—Ä–≤–∏—Å –≤—ã–≤–æ–¥–∏—Ç –ø–æ–¥—Ä–æ–±–Ω—ã–µ –ª–æ–≥–∏:

```
üîÑ –í—Ö–æ–¥–Ω–æ–π –ø–æ—Å—Ç —É–∂–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω —Ä–∞–Ω–µ–µ: Bitcoin –¥–æ—Å—Ç–∏–≥ –Ω–æ–≤–æ–≥–æ –º–∞–∫—Å–∏–º—É–º–∞...
‚úÖ –î–æ–±–∞–≤–ª–µ–Ω —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç: Ethereum –∑–∞–ø—É—Å—Ç–∏–ª –Ω–æ–≤–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ...
‚ùå –î—É–±–ª–∏–∫–∞—Ç –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω: –ë–∏—Ç–∫–æ–∏–Ω —É—Å—Ç–∞–Ω–æ–≤–∏–ª —Ä–µ–∫–æ—Ä–¥...
üìä –†–µ–∑—É–ª—å—Ç–∞—Ç: 4 -> 2 (–ø–æ—Å–ª–µ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤)
üîÑ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞ –∫–µ—à–∞: —É–¥–∞–ª–µ–Ω–æ 1250 –∑–∞–ø–∏—Å–µ–π
‚è∞ –°–ª–µ–¥—É—é—â–∞—è –æ—á–∏—Å—Ç–∫–∞ —á–µ—Ä–µ–∑ 24 —á–∞—Å–∞: 2024-01-16 14:30:00
```

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

```python
# –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏
import time

start_time = time.time()
result = process_posts(posts)
processing_time = time.time() - start_time
print(f"‚è±Ô∏è –í—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏: {processing_time:.2f} —Å–µ–∫—É–Ω–¥")
```

### Health Check —ç–Ω–¥–ø–æ–∏–Ω—Ç

```python
@app.get('/health')
async def health_check():
    return {
        "status": "healthy",
        "timestamp": datetime.now().isoformat(),
        "cache_size": len(processed_content_hashes),
        "gemini_model": "gemini-1.5-flash"
    }
```

---

## Troubleshooting

### –ß–∞—Å—Ç—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –∏ —Ä–µ—à–µ–Ω–∏—è

#### 1. **AI —Å–µ—Ä–≤–∏—Å –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç**

**–ü—Ä–æ–±–ª–µ–º–∞:** `Connection refused` –∏–ª–∏ timeout
**–†–µ—à–µ–Ω–∏—è:**
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, –∑–∞–ø—É—â–µ–Ω –ª–∏ —Å–µ—Ä–≤–∏—Å: `curl http://localhost:8000/health`
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å logs —Å–µ—Ä–≤–∏—Å–∞
- –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–∏—Å

#### 2. **Gemini API –æ—à–∏–±–∫–∏**

**–ü—Ä–æ–±–ª–µ–º–∞:** `‚ùå Gemini Error: 403 Forbidden`
**–†–µ—à–µ–Ω–∏—è:**
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å API –∫–ª—é—á –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–≤–æ—Ç—ã Gemini API
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ñ–æ—Ä–º–∞—Ç –∑–∞–ø—Ä–æ—Å–æ–≤

#### 3. **–ö–µ—à –Ω–µ –æ—á–∏—â–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏**

**–ü—Ä–æ–±–ª–µ–º–∞:** –ö–µ—à —Ä–∞—Å—Ç–µ—Ç –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ
**–†–µ—à–µ–Ω–∏—è:**
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ –∞–≤—Ç–æ–æ—á–∏—Å—Ç–∫–∏
- –ó–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω—É—é –æ—á–∏—Å—Ç–∫—É: `/force_auto_clear`
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–∏—Å—Ç–µ–º–Ω–æ–µ –≤—Ä–µ–º—è

#### 4. **–î—É–±–ª–∏–∫–∞—Ç—ã –Ω–µ —Ñ–∏–ª—å—Ç—Ä—É—é—Ç—Å—è**

**–ü—Ä–æ–±–ª–µ–º–∞:** –û–¥–∏–Ω–∞–∫–æ–≤—ã–µ –ø–æ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—é
**–†–µ—à–µ–Ω–∏—è:**
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ñ—É–Ω–∫—Ü–∏—é –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏ —Ç–µ–∫—Å—Ç–∞
- –û—á–∏—Å—Ç–∏—Ç—å –∫–µ—à –∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –∑–∞–Ω–æ–≤–æ
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏

#### 5. **–ú–µ–¥–ª–µ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞**

**–ü—Ä–æ–±–ª–µ–º–∞:** –ó–∞–ø—Ä–æ—Å—ã –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –¥–æ–ª–≥–æ
**–†–µ—à–µ–Ω–∏—è:**
- –£–º–µ–Ω—å—à–∏—Ç—å —Ä–∞–∑–º–µ—Ä –±–∞—Ç—á–µ–π
- –£–≤–µ–ª–∏—á–∏—Ç—å timeout –≤ –∫–ª–∏–µ–Ω—Ç–µ
- –ú–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å –Ω–∞–≥—Ä—É–∑–∫—É –Ω–∞ Gemini API

### –î–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–∏–µ –∫–æ–º–∞–Ω–¥—ã

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ —Å–µ—Ä–≤–∏—Å–∞
curl -X GET http://localhost:8000/health

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –∫–µ—à–∞
curl -X GET http://localhost:8000/gemini/cache_stats

# –¢–µ—Å—Ç–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å
curl -X POST http://localhost:8000/gemini/filter \
  -H "Content-Type: application/json" \
  -d '{"posts": ["Test post"], "has_image": false}'

# –û—á–∏—Å—Ç–∫–∞ –∫–µ—à–∞ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
curl -X POST http://localhost:8000/gemini/clear_cache
```

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è

```python
import logging

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–æ–¥—Ä–æ–±–Ω–æ–≥–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
logging.basicConfig(
    level=logging.DEBUG,
    format='%(asctime)s - %(name)s - %(levelname)s - %(message)s',
    handlers=[
        logging.FileHandler('ai_service.log'),
        logging.StreamHandler()
    ]
)
```

---

## –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

AI Service –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –Ω–∞–¥–µ–∂–Ω—É—é –∏ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—É—é –æ–±—Ä–∞–±–æ—Ç–∫—É –ø–æ—Å—Ç–æ–≤ —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ–º –¥—É–±–ª–∏–∫–∞—Ç–∞–º–∏. –°–∏—Å—Ç–µ–º–∞ —Å–ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∞ –¥–ª—è –∞–≤—Ç–æ–Ω–æ–º–Ω–æ–π —Ä–∞–±–æ—Ç—ã —Å –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–º –≤–º–µ—à–∞—Ç–µ–ª—å—Å—Ç–≤–æ–º –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞.

### –ö–ª—é—á–µ–≤—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:
- ü§ñ **–£–º–Ω–∞—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è** —á–µ—Ä–µ–∑ Gemini AI
- üîÑ **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–µ—à–µ–º**
- üìä **–ü–æ–¥—Ä–æ–±–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥**
- üõ°Ô∏è **–ù–∞–¥–µ–∂–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –¥—É–±–ª–∏–∫–∞—Ç–æ–≤**
- ‚ö° **–í—ã—Å–æ–∫–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å** —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –±–∞—Ç—á–µ–π

–î–ª—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –∏–ª–∏ –≤–æ–ø—Ä–æ—Å–æ–≤, –æ–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ –ª–æ–≥–∞–º —Å–µ—Ä–≤–∏—Å–∞ –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞. 